\documentclass[a4paper,10pt]{article}
%\documentclass[a4paper,10pt]{scrartcl}

\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{catoptions}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{soul}
\usepackage{float}
\usepackage{framed}
\usepackage[sc]{mathpazo}
\linespread{1.20}         % Palatino needs more leading (space between lines)
\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage{enumerate}
\usepackage{courier}
\usepackage{graphicx}
\usepackage{xfrac}
\usepackage{enumitem}

\newcommand{\authorbd}{Bas Dado (4033736)}
\newcommand{\authoroh}{Olivier Hokke (1352679)}
\newcommand{\authortr}{Tom Runia (1517996)}
\newcommand{\authoras}{Arnold Schutter (4260724)}
\newcommand{\authortv}{Tom Viering (4333055)}
\newcommand{\maintitle}{Artificial Intelligence}
\newcommand{\subtitle}{BOAconstructor -- An Automated Negotiation Agent}

\title{\maintitle\\\subtitle}
\author{\authorbd\\\authoroh\\\authortr\\\authoras\\\authortv}
\date{\today}

\pdfinfo{%
  /Title    (\maintitle - \subtitle)
  /Author   (\authorbd, \authoroh, \authortr, \authoras, \authortv)
  /Creator  (\authorbd, \authoroh, \authortr, \authoras, \authortv)
  /Producer (\authorbd, \authoroh, \authortr, \authoras, \authortv)
  /Subject  (Automated Negotiation)
  /Keywords (Automated Negotiation, Genius, Bidding Strategy, Acceptance Strategy, Opponent Model, Opponent Model Strategy)
}

% Settings for hyperref package (e.g. wat \autoref en \nameref moeten doen)
\hypersetup{
  bookmarks   = false
  colorlinks  = false,
  linkcolor   = [rgb]{0.1,0.1,0.5},
  citecolor   = [rgb]{0.5,0.1,0.1},
  filecolor   = [rgb]{0.1,0.5,0.5},
  urlcolor    = [rgb]{0.1,0.1,0.7}
}

% Adds the command "\Autoref" to make it possible to use a capital in the referenced object name
\makeatletter
\def\figureautorefname{figure}
\def\tableautorefname{table}
\def\Autoref#1{%
  \begingroup
  \edef\reserved@a{\cpttrimspaces{#1}}%
  \ifcsndefTF{r@#1}{%
    \xaftercsname{\expandafter\testreftype\@fourthoffive}
      {r@\reserved@a}.\\{#1}%
  }{%
    \ref{#1}%
  }%
  \endgroup
}
\def\testreftype#1.#2\\#3{%
  \ifcsndefTF{#1autorefname}{%
    \def\reserved@a##1##2\@nil{%
      \uppercase{\def\ref@name{##1}}%
      \csn@edef{#1autorefname}{\ref@name##2}%
      \autoref{#3}%
    }%
    \reserved@a#1\@nil
  }{%
    \autoref{#3}%
  }%
}
\makeatother

% Settings for listings of java code
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{light-gray}{gray}{0.95}
\lstset{basicstyle=\footnotesize\ttfamily,breaklines=true,language=Java}
\lstset{frame=single,commentstyle=\color{mygreen},keywordstyle=\color{blue}}
\lstset{aboveskip=0.5cm,belowskip=0.3cm}
\lstset{backgroundcolor=\color{light-gray}}

% Define the todo command
\newcommand{\todo}[1] {\hl{TODO: #1}}
\setlength{\parindent}{0cm}

\begin{document}

\begin{center}
\vskip 1cm
{\Huge Artificial Intelligence \vskip 2mm}
{\Large Automated Negotation: \\BOA constructor agent\vskip 1cm}

{\normalsize \textbf{Bas Dado} ($4033736$) -- \textbf{Olivier Hokke} ($1352679$) -- \textbf{Tom Runia} ($1517996$) \vskip 2mm \textbf{Tom Viering} ($4333055$) -- \textbf{Arnold Schutter} ($4260724$) \vskip 3cm}

\end{center}

\begin{abstract}
\noindent A relatively new and evolving branch of artificial intelligence is \emph{automated negotiation}. In automated negotiation, two or more agents negotiate about a multi-issue problem in order to find a solution that maximizes their utility. The utilities for each possible bid are determined using a human-defined preference profile, which consists of weights for each of the issues and a utility for each possible value of the issues. \\

\noindent In this report we describe the process of creating our agent, \texttt{BOAconstructor}, for automated negotiation. \Autoref{sec:exercises} contains the answers to the questions posed in the assignment concerning the party domain and genius in general. 
\Autoref{sec:strategy} describes the strategy our agent uses. The main chapter contains the high-level description of the agent. In the subsections, \autoref{sec:strategyAS}, \autoref{sec:strategyBS}, \autoref{sec:strategyOM} and \autoref{sec:strategyOMS}, we go into more detail about the specific \emph{BOA components}. \Autoref{sec:performance} shows the results of performance tests of our final agent against a number agents that were included in genius. In \Autoref{sec:conclusion} we describe our experience regarding building the agent and decide what is needed in order to use our agent in real world negotiations.
\end{abstract}

\newpage
\tableofcontents
\newpage


\section{Assignments}
\label{sec:exercises}

\subsection{Analysis of the Party domain}

\subsubsection{Bidding Space and Pareto Frontier}

In this subsection we analyse the \emph{Party domain} and compute the Pareto Frontier. The party domain is a negotiation domain which consists of $6$ issueas that each contain three or four possibilities: 

\begin{enumerate}[itemsep=0mm]
  \item \textbf{Food} (4 options)
  \item \textbf{Drinks} (4 options)
  \item \textbf{Location} (4 options)
  \item \textbf{Invitations} (4 options)
  \item \textbf{Music} (3 options)
  \item \textbf{Clean-Up} (4 options)
\end{enumerate}

The issues and possible options are good for a total of $3072$ possible outcomes ($4 \times 4 \times 4 \times 4 \times 3 \times 4$). We have used the \emph{preference profiles} of users $10$ and $15$ and analyzed these to compute the \emph{outcome space} and \emph{Pareto Frontier}. Both of these are given in the figure below.

\begin{figure}[H]
\begin{center}
 \includegraphics[width=0.8\textwidth]{pareto.png}
 \caption{The outcome space with the \emph{Pareto Optimal Frontier} indicated as a red line.}
 \label{fig:pareto} 
\end{center}
\end{figure}

\clearpage

\subsubsection{Performance of the \texttt{SimpleAgent}}

Finally, we perform two negotiation sessions: we play with the agent \texttt{SimpleAgent} against itself, and we play Boulware vs Conceder and discuss the outcome. When we play SimpleAgent against itself, we notice the behaviour is quite random. This is explained by having a loo at the code; it always offers a random bid higher than a certain threshold,
by default this threshold is zero. Therefore it performs a \emph{random walk} through the 
bidding space. The acceptance strategy works as follows: it calculates a probability for each bid and the higher the bid, the higher the probability. If the deadline approaches it will accept all bids with higher probability. It will however never accept bids with a utility of zero. The equation that determines the probability of acceptance is:
\begin{align}
P = \frac{u - 2ut + 2(-1 + t + \sqrt{((-1 + t)^2 + u(-1 + 2t)})}{-1 + 2t}
\end{align}

Where $P$ denotes the probability of acceptance, $u$ denotes the utility of the bid and $t$ denotes the time in a range of $[0, 1]$. Because of this behaviour we found the average utility playing against itself is around $0.68$, and the time needed to reach an agreement was very short: $0.03$ (averaged over $20$ negotiations on the party domain).
This is quite logical, since both sides offer random bids, it is the
case quite soon that either bid has a high probability of acceptance for the opposing party. When this agent negotiates with other agents, it performs badly, because
it offers random bids. Smart agents will accept good offers and deny other offers,
and because of this the obtained utility for the simple agent will be quite low.
We confirm this by letting simple agent play against Boulware. In these tests the simpleagent obtains an average utility of $0.6$ while the Boulware agent scores on average $1.0$. 

\subsubsection{Performance of the \texttt{Boulware} vs. \texttt{Conceder}}
Finally, we play with the Boulware agent against the conceder agent. A typical negotiation trace is displayed below: \\

\begin{figure}[H]
\begin{center}
 \includegraphics[width=0.9\textwidth]{traceConcederBoulware.png}
 \caption{The \emph{Pareto Optimal Frontier} is displayed with a red line in this figure.}
 \label{fig:pareto} 
\end{center}
\end{figure}

In this figure, the green and blue lines are the bidding-traces for respectively the Boulware and the Conceder agent. The boulware agent chooses the best bid for itself, and keeps offering this bid. This agent only concedes at the very last moments before the deadline. The conceder agent on the other hand starts conceding directly and keeps on conceding every new bid. We ran simulations on the party domain using these agents. Averaging over 20 negotiations the Conceder reached an utility of $0.67$ and
Boulware $0.99$. 
 
\subsection{PEAS Description}

The first step in designing an agent is to specify the environment as fully as possible. In order to do this we specify the PEAS description which lists the following aspects of the environment: \emph{Performance}, \emph{Environment}, \emph{Actuators} and \emph{Sensors}. This measure is extensively discussed in Russel and Norvig \cite{russel-norvig}, so we adapt their notation.

\begin{table}[H]
  \small
    \begin{tabular}{|p{1.8cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
    \hline
    \textbf{Agent} & \textbf{Performance \mbox{Measure}} & \textbf{Environment} & \textbf{Actuators} & \textbf{Sensors} \\
    \hline
    BOA Agent & Own $($versus opponents$)$ discounted final utility & Negotiation space defined by Genius, \mbox{Opponents} & New bid offering, \mbox{accepting/rejecting} offers & Biddings of the \mbox{opponent} agent \\
    \hline
    \end{tabular}
    
    \caption{PEAS description for our negotiation agent \label{table:peas-description}}
\end{table}

Table~\ref{table:peas-description} displays the PEAS description for our agent. We will briefly discuss each of the descriptions. First the \emph{environment} our agent operates in, this is the negotiation space as defined by Genius. It contains all the possible bids, each resulting in an individual utility for the agents. The \emph{performance} is measured by the utility for the agent, which in this project has to be as high as possible $($with a maximum of $1)$ and preferably equal to or higher than the opponents utility. There are two \emph{actuators}, first of all the acceptance or rejection of a bid of an opponent. The second actuator is the offering of a new bid. The bid is based on the biddings of the opponent, which is the only \emph{sensor} the agent has. Under the surface of the PEAS elements, different java-classes, algorithms and calculations are performed, like the \textit{nash-point} and the \textit{Kalai-Smorodinsky solution}. These will be explained in more detail in the next sections.

\subsection{BOA Framework}

Most negotiation agents consist of three components: \emph{Bidding strategy}, \emph{Opponent model} and \emph{Acceptance strategy}. Together these three components form the \emph{BOA framework}. As discussed by Baarslag et al., the advantages of separating the components using this framework are threefold \cite{baarslag2012decoupling}. In designing our negotiation agent the most useful advantage was the fact that it allows for easily changing individual components and analyze the interaction between the components. Below we provide a small description for the three required components.

\begin{description}
  \item[Bidding Strategy] \hfill \\
  The bidding strategy (BS) is arguably the most important component. It's goal is to determine the next bid that will be offered to the opponent. In determining the next bid the agent can interact with the opponent model to provide a suitable offer. Sometimes the negotiation session is split up in multiple phases and each of the phases use a different bidding strategy.

  \item[Opponent Model] \hfill \\
  Analyzing the opponents behaviour is essential for being able to determine the opponent's preference profile.  With a well defined opponent model (OM), the opponent's utility of a bid can be determined more accurate. In practice this works by estimating the opponents \emph{preference profile}, which is usually done by adapting \emph{Bayesian modeling} or \emph{frequency analysis}. 

  \item[Acceptance Strategy] \hfill \\
  Negotiation sessions ideally end by reaching an agreement. The acceptance strategy (AS) decides whether the opponents offer should be accepted or a new bid has to be offered. A broad variety of acceptance strategies is available with combinations of time-dependend, utility-dependent and threshold-dependent strategies.

\item[Opponent Model Strategy] \hfill \\
  Analyzing the opponents behaviour could, except for determining the opponent's preference profile, also be used to determine the strategy the opponent is using, like \emph{Hardheaded}, \emph{Conceder}, \emph{Tit-for-Tat}, etc. The own bidding strategy can be adapted to the opponent's model strategy (OMS), to derive a maximum possible outcome for the own utility.

\end{description}

\section{Strategy}
\label{sec:strategy}

\subsection{Bidding Strategy}
\label{sec:strategyBS}
\input{strategy_bidding_strategy}

\subsection{Opponent Model}
\label{sec:strategyOM}
\input{strategy_opponent_model}

\subsection{Acceptance Strategy}
\label{sec:strategyAS}
\input{strategy_acceptance_strategy}

\subsection{Opponent Model Strategy} 
\label{sec:strategyOMS}
\input{strategy_opponent_strategy_model}

\section{Testing \& Performance}
\label{sec:performance}
\input{testing_and_performance}


\section{Conclusion}
\label{sec:conclusion}
\input{conclusion}

\bibliography{negotiation_final_report}
\bibliographystyle{plain}

\end{document}
